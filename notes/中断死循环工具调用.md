# 问题描述：
当ai调用知识库工具，搜索内容时，很容易进入死循环
这个时候没有任何手段终止它
包括输入内容再拒绝工具调用

## 解决方案
1. 加强输入的附加消息的地位
———— 将用户消息提取出来，作为一个单独的HumanMessage，而不是放在ToolMessage里面

2. 强制终止流式消息
———— 使用一个全局中断实例，控制后端api端点的流式输出

==========
相关知识：
1. 为什么使用asyncio.Event()
self._active_tasks[thread_id] = asyncio.Event()
把 Event 看作一个开关：

初始状态：开关关闭（.is_set() = False）
调用 .set()：打开开关（.is_set() = True）
一旦打开，就保持打开状态（除非重新创建新的 Event）


———— 2026/2/22